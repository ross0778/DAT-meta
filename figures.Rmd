---
title: "figures"
output: html_document
---

## Forest Plot with Didactic and Pre-Clinical Course Grades
```{r}
library(tidyverse)
library(ggplot2)

preclinical_data <- tibble(
  predictor = c("Academic Average", "Biology", "Carving Dexterity", "Chemistry",
                "Factual Science", "Mechanical Aptitude", "PAT",
                "Quantitative Reasoning", "Reading Comprehension", "Science Application",
                "Space Relations", "Total Science"),
  r = c(.06, .00, .22, .09, .03, .41, .37, .07, .12, .06, .26, .08),
  lower = c(-.01, -.12, .06, -.03, -.09, .27, .25, -.05, .00, -.06, .15, -.01),
  upper = c(.13, .12, .38, .21, .15, .55, .49, .19, .24, .18, .37, .17),
  k = c(9, 2, 2, 2, 2, 5, 3, 2, 2, 2, 2, 4),
  N = c(731, 266, 266, 266, 266, 165, 433, 266, 266, 266, 266, 522),
  outcome = "Pre-Clinical Course Grades"
)

didactic_data <- tibble(
  predictor = c("Academic Average", "Biology", "Carving Dexterity", "Chemistry",
                "Factual Science", "PAT", "Quantitative Reasoning",
                "Reading Comprehension", "Science Application", "Space Relations", "Total Science"),
  r = c(.17, .12, -.05, .17, .17, .04, .05, .12, .15, -.01, .18),
  lower = c(.09, .00, -.24, .05, .05, -.08, -.11, .00, .03, -.13, .10),
  upper = c(.25, .24, .14, .29, .29, .16, .21, .24, .27, .11, .26),
  k = c(4, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4),
  N = c(517, 266, 266, 266, 266, 256, 266, 266, 266, 266, 522),
  outcome = "Didactic Course Grades"
)

my_data <- bind_rows(preclinical_data, didactic_data)

# Factor levels: GPA predictors in order (didactic-only predictors drop to bottom)
all_predictors <- unique(preclinical_data$predictor)
didactic_only <- setdiff(unique(didactic_data$predictor), all_predictors)
level_order <- rev(c(all_predictors, didactic_only))

my_data$predictor <- factor(my_data$predictor, levels = level_order)

# Use a fixed x position for ALL annotation text so they align in a clean column
LABEL_X <- 0.72  # Adjust this value left/right to taste

pd <- position_dodge(width = 0.7)

p <- ggplot(my_data, aes(x = r, y = predictor, color = outcome)) +
  geom_errorbarh(aes(xmin = lower, xmax = upper),
                 position = pd,
                 height = 0.3,
                 linewidth = 0.8) +
  geom_point(position = pd, size = 3) +
  geom_vline(xintercept = 0, linetype = "dotted", color = "grey40") +
  
  # Fixed x position so labels don't scatter with CI width
  geom_text(aes(x = LABEL_X,
                label = paste0("k=", k, ", N=", N)),
            position = pd,
            hjust = 0,
            size = 2.9,
            show.legend = FALSE) +
  
  scale_color_manual(
    values = c("Pre-Clinical Course Grades" = "#2c7bb6", "Didactic Course Grades" = "#d7191c")
  ) +
  
  scale_x_continuous(
    name = "Meta-Analytic Correlation (r)",
    limits = c(-0.3, 1.05),
    breaks = seq(-0.2, 0.6, by = 0.2),
    expand = c(0, 0)
  ) +
  
  labs(
    title = "Predictive Validity of DAT Subsections for Dental School Academic Performance",
    y = NULL,  # y-axis label is self-evident from the predictor names
    color = "Outcome"
  ) +
  
  theme_minimal(base_size = 12) +
  theme(
    panel.grid.major.y = element_line(color = "grey92", linewidth = 0.4),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_line(color = "grey92", linewidth = 0.4),
    legend.position = "bottom",
    legend.title = element_text(face = "bold"),
    plot.title = element_text(size = 12, face = "bold", margin = margin(b = 12)),
    axis.text.y = element_text(size = 10),
    plot.margin = margin(15, 20, 15, 15)
  )

# Save with explicit height/width â€” this is the most important fix for squishing
ggsave("forest_plot.png", plot = p,
       width = 10, height = 8.5, dpi = 300, bg = "white")
```

## Forest Plot with just Didactic Course Grades
```{r}
library(tidyverse)
library(ggplot2)

preclinical_data <- tibble(
  predictor = c("Academic Average", "Biology", "Carving Dexterity", "Chemistry",
                "Factual Science", "Mechanical Aptitude", "PAT",
                "Quantitative Reasoning", "Reading Comprehension", "Science Application",
                "Space Relations", "Total Science"),
  r = c(.06, .00, .22, .09, .03, .41, .37, .07, .12, .06, .26, .08),
  lower = c(-.01, -.12, .06, -.03, -.09, .27, .25, -.05, .00, -.06, .15, -.01),
  upper = c(.13, .12, .38, .21, .15, .55, .49, .19, .24, .18, .37, .17),
  k = c(9, 2, 2, 2, 2, 5, 3, 2, 2, 2, 2, 4),
  N = c(731, 266, 266, 266, 266, 165, 433, 266, 266, 266, 266, 522)
)

# Order predictors top-to-bottom
preclinical_data$predictor <- factor(
  preclinical_data$predictor,
  levels = rev(preclinical_data$predictor)
)

LABEL_X <- 0.72  # fixed position for k/N labels

p <- ggplot(preclinical_data, aes(x = r, y = predictor)) +
  
  geom_errorbarh(aes(xmin = lower, xmax = upper),
                 height = 0.3,
                 linewidth = 0.8,
                 color = "#2c7bb6") +
  
  geom_point(size = 3,
             color = "#2c7bb6") +
  
  geom_vline(xintercept = 0,
             linetype = "dotted",
             color = "grey40") +
  
  geom_text(aes(x = LABEL_X,
                label = paste0("k=", k, ", N=", N)),
            hjust = 0,
            size = 3) +
  
  scale_x_continuous(
    name = "Meta-Analytic Correlation (r)",
    limits = c(-0.3, 1.05),
    breaks = seq(-0.2, 0.6, by = 0.2),
    expand = c(0, 0)
  ) +
  
  labs(
    title = "Predictive Validity of DAT Subsections for Pre-Clinical Course Grades",
    y = NULL
  ) +
  
  theme_minimal(base_size = 12) +
  theme(
    panel.grid.major.y = element_line(color = "grey92", linewidth = 0.4),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_line(color = "grey92", linewidth = 0.4),
    plot.title = element_text(size = 12, face = "bold", margin = margin(b = 12)),
    axis.text.y = element_text(size = 10),
    plot.margin = margin(15, 20, 15, 15)
  )

ggsave("preclinical_forest_plot.png",
       plot = p,
       width = 10, height = 8.5, dpi = 300, bg = "white")

```

